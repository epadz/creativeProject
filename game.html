<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scattergories</title>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script type ="text/javascript">
var auid;
var ausername;
var ascore;

var socketio = io.connect();
socketio.on('connect', function(){
	//alert("connected");
	//socketio.emit('setUN', prompt("pick a username"));
})

//when it gets the list of rooms, create the html elements to show
socketio.on("updateGameList",function(data){
	var elems = "";
	$.each(data, function(xgid, xgpop){
		elems += '<div class="game" data-gid="' + xgid + '" onclick="joinGame(' + xgid + ')"><div class="population">' + xgpop + '<span class="popLimit">/6</span></div><div class="join">join</div></div>';
	});
	elems += '<div class="game" onclick="createNewGame()"><div class="newGame">new game</div></div>';
	$("#games").html(elems);
});

socketio.on("updatePlayerList",function(data){
	var elems = "";
	$.each(data, function(xpid, xp){
		elems += '<div class="player" data-id="' + xpid + '"><div class="pun">' + xp.un + '</div><div class="ppt">' + xp.score + '</div></div>';
	});
	$("#playerList").html(elems);
});

socketio.on("playerAdded",function(data){
	var elem = '<div class="player" data-id="' + data.xpid + '"><div class="pun">' + data.xun + ' ' + data.xpid + '</div><div class="ppt">' + data.xscore + '</div></div>';
	$("#playerList").append(elem);
});

socketio.on("playerLeft",function(data){
	$("#playerList [data-id='" + data + "']").animate({top:"15vh"}, 500, function(){
		$("#playerList [data-id='" + data + "']").remove();
	});
});
//when a current game is clicked to enter
function joinGame(xgid){
	socketio.emit('joinGame', xgid);
}
//when create new game is clicked
function createNewGame(){
	socketio.emit('createNewGame', null);
}
//when it receives response that game has been created or joined and now the player must go to the waiting for more players screen
socketio.on("joined_wait",function(data){
	setView(3);
});
//when it receives notification that the round has started and is given the list of players and their scores
socketio.on("startRound",function(data){
	setView(1);
	$("#cat").html(data.cat + '<div id="letter">' + data.letter + '</div>');
});
//when the player submits an answer -> change submit button to say waiting, make it not do anything on click and make input readonly 

//when it receives notification that the round has ended and is given the array of answer objects

//when the player downvotes an answer

//when other players downvote an answer and/or an answer becomes invalid

//when a player leaves the game
socketio.on("insufficientPlayers",function(data){
	setView(3);
});

//login functions
//register
function register(){
	un = $("#un").val() + "";
	pw = $("#pw").val() + "";
	
	if(un != "" && un != " " && pw != "" && pw != " "){
		socketio.emit('register', {un: un, pw: pw});
	}else{
		$("#lrMessage").css("display","block");
		$("#lrMessage").html("Please enter valid input");
	}
}
//register response
socketio.on("unTaken", function(data){
	$("#lrMessage").css("display","block");
	$("#lrMessage").html("That username is taken. Please try a different one");
});
socketio.on("registerSuccess", function(data){
	auid = parseInt(data.id);
	ascore = parseInt(data.score);
	ausername = data.un;
	setView(0);
	$("#un").val('');
	$("#pw").val('');
	$("#tbUn").html(ausername + "");
	$("#tbPts").html(ascore + " points");
});

//login
function login(){
	un = $("#un").val() + "";
	pw = $("#pw").val() + "";
	
	if(un != "" && un != " " && pw != "" && pw != " "){
		socketio.emit('login', {un: un, pw: pw});
	}else{
		$("#lrMessage").css("display","block");
		$("#lrMessage").html("Please enter valid input");
	}
}
//login response
socketio.on("badLogin", function(data){
	$("#lrMessage").css("display","block");
	$("#lrMessage").html("Incorrect username or password!");
});
socketio.on("loginSuccess", function(data){
	auid = parseInt(data.id);
	ascore = parseInt(data.score);
	ausername = data.un;
	setView(0);
	$("#un").val('');
	$("#pw").val('');
	$("#tbUn").html(ausername + "");
	$("#tbPts").html(ascore + " points");
});

//function to set the current view
function setView(xview){	//0 is games list, 1 is game play, 2 is review, 3 is waiting screen, 4 is login and register
	switch(xview){
		case 0:
			$("#timerO").css("display","none");
			$("#cat").css("display","none");
			$("#play").css("display","none");
			$("#review").css("display","none");
			$("#playerList").css("display","none");
			$("#games").css("display","block");
			$("#waiting").css("display","none");
			$("#logreg").css("display","none");
			$("#topBar").css("display","block");
			break;
		case 1:
			$("#timerO").css("display","block");
			$("#cat").css("display","block");
			$("#play").css("display","block");
			$("#review").css("display","none");
			$("#playerList").css("display","block");
			$("#games").css("display","none");
			$("#waiting").css("display","none");
			$("#logreg").css("display","none");
			$("#topBar").css("display","block");
			break;
		case 2:
			$("#timerO").css("display","block");
			$("#cat").css("display","block");
			$("#play").css("display","none");
			$("#review").css("display","block");
			$("#playerList").css("display","block");
			$("#games").css("display","none");
			$("#waiting").css("display","none");
			$("#logreg").css("display","none");
			$("#topBar").css("display","block");
			break;
		case 3:
			$("#timerO").css("display","none");
			$("#cat").css("display","none");
			$("#play").css("display","none");
			$("#review").css("display","none");
			$("#playerList").css("display","block");
			$("#games").css("display","none");
			$("#waiting").css("display","block");
			$("#logreg").css("display","none");
			$("#topBar").css("display","block");
			break;
		case 4:
			$("#timerO").css("display","none");
			$("#cat").css("display","none");
			$("#play").css("display","none");
			$("#review").css("display","none");
			$("#playerList").css("display","none");
			$("#games").css("display","none");
			$("#waiting").css("display","none");
			$("#logreg").css("display","block");
			$("#topBar").css("display","none");
			break;
	}
}
</script>
<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="setView(4)">
	<!-- TOP BAR -->
    <div id="topBar" style="display:none">
    	<span id="tbUn">NULL</span>&nbsp;&nbsp;&nbsp;<span id="tbLo">log out</span>&nbsp;&nbsp;&nbsp;<span id="tbPts">points</span>&nbsp;&nbsp;&nbsp;<span id="tbRk">top 10%</span>&nbsp;&nbsp;&nbsp;<span id="tbHs">high scores</span>
    </div>
	<!-- 3: WAITING SCREEN -->
    <div id="waiting">
    	waiting to join game
        <div id="waitingBall"></div>
    </div>
    
    <!-- 1/2: GAME PLAY AND REVIEW SCREENS -->
	<div id="timerO" style="display:none"><div id="timerI"></div></div>
	<div id="cat" style="display:none">Famous duos and trios<div id="letter">M</div></div>
	<div id="play" class="content" style="display:none">
    	<div id="gameContent">
            <div id="input"><input type="text" /></div>
            <div id="submit">GO</div>
        </div>
    </div>
    <div id="review" class="content" style="display:none">
    	<div id="answers">
        	<div class="answer valid">
            	<div class="aun">eliot</div>
                <div class="answerText"><span>Micky and Minnie Mouse</span></div>
                <div class="strikes">
                	<div class="strike"></div><div class="strike"></div><div class="strike"></div><div class="strike"></div><div class="strike"></div>
                    <div class="vote" style="display:none"></div>
                </div>                
            </div>
            <div class="answer valid">
            	<div class="aun">kenny</div>
                <div class="answerText"><span>Mary, Peter and Paul</span></div>
                <div class="strikes">
                	<div class="strike"></div><div class="strike"></div><div class="strike"></div><div class="strike"></div><div class="strike"></div>
                    <div class="vote"></div>
                </div>                
            </div>
            <div class="answer flaggedAnswer">
            	<div class="flag"></div>
            	<div class="aun">steve</div>
                <div class="answerText"><span>Mario and Luigi</span></div>
                <div class="strikes">
                	<div class="strike struck"></div><div class="strike struck"></div><div class="strike"></div><div class="strike"></div><div class="strike"></div>
                    <div class="vote"></div>
                </div>                
            </div>
            <div class="answer flaggedAnswer">
            	<div class="flag"></div>
            	<div class="aun">david</div>
                <div class="answerText"><span>Mario and Luigy</span></div>
                <div class="strikes">
                	<div class="strike struck"></div><div class="strike struck"></div><div class="strike"></div><div class="strike"></div><div class="strike"></div>
                    <div class="vote"></div>
                </div>                
            </div>
            <div class="answer invalid">
            	<div class="aun">paul</div>
                <div class="answerText"><span>X</span></div>
                <div class="strikes">
                	<div class="strike struck"></div><div class="strike struck"></div><div class="strike struck"></div><div class="strike struck"></div><div class="strike struck"></div>
                    <div class="vote" style="display:none"></div>
                </div>                
            </div>
            <div class="answer invalid">
            	<div class="aun">bob</div>
                <div class="answerText"><span>Burt and Ernie</span></div>
                <div class="strikes">
                	<div class="strike struck"></div><div class="strike struck"></div><div class="strike struck"></div><div class="strike struck"></div><div class="strike struck"></div>
                    <div class="vote" style="display:none"></div>
                </div>                
            </div>
        </div>
    </div>
    <div id="playerList" style="display:none">

    </div>
    
    <!-- 0: GAMES LIST -->
    <div id="games" style="display:none">
    	
    </div>
    
    <!-- login / register-->
    <div id="logreg" style="display:block">
		<div class="lrTitle">login</div>
        <div id="lrMessage"></div>
    	<div id="login">        	
        	<input id="un" type="text" placeholder="username" />
            <input id="pw" type="password" placeholder="password" />
            <div class="sublog" onClick="login()">login</div><div class="sublog" onClick="register()">register</div>
        </div>        
    </div>
</body>
</html>
